<div class="container py-3">
  <!-- Header -->
  <div class="d-flex align-items-center justify-content-between mb-4">
    <h3 class="fw-bold mb-0">
      Actividad de usuarios <i class="fa fa-users"></i>
    </h3>
  </div>

  <div *ngIf="!processing">
    <!-- Tabla -->
    <div class="table-responsive shadow-sm rounded bg-white">
      <table class="table table-hover align-middle mb-0">
        <thead class="table-light">
          <tr>
            <th>Nickname</th>
            <th class="text-center">Contadores</th>
            <th class="text-center">Recaídas</th>
            <th>Email</th>
            <th class="text-center">Restablecer</th>
            <th class="text-center">Impersonar</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let u of users; index as i">

            <td class="fw-semibold">
              {{u.nickName}}
            </td>

            <td class="text-center text-muted">
              {{u.counterEventsCount}}
            </td>

            <td class="text-center text-muted">
              {{u.relapsesCount}}
            </td>

            <td class="text-muted">
              {{u.email}}
            </td>

            <td class="text-center">
              <i class="fa fa-envelope text-success action-icon"
                 title="Enviar correo de restablecimiento"
                 (click)="openConfirmModal(u)">
              </i>
            </td>

            <td class="text-center">
              <button class="btn btn-outline-success btn-sm"
                      (click)="impersonate(u.userID)">
                Impersonar
              </button>
            </td>

          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>
<!-- Spinner -->
<div *ngIf="processing"
     class="d-flex justify-content-center align-items-center spinner-wrapper">
  <div class="spinner-border text-success"
       style="width: 4rem; height: 4rem;">
  </div>
</div>

<!-- Modal -->
<ng-template #confirmModal let-modal>
  <div class="modal-header">
    <h4 class="modal-title">Confirmación</h4>
    <button type="button"
            class="btn-close"
            aria-label="Close"
            (click)="modal.dismiss('cancel')">
    </button>
  </div>

  <div class="modal-body">
    <p *ngIf="!processing && !feedbackMessage">
      ¿Estás seguro que deseas enviar el correo de restablecimiento de contraseña a
      <strong>{{ selectedUser?.email }}</strong>?
    </p>

    <div *ngIf="!processing && feedbackMessage"
         [innerHTML]="feedbackMessage">
    </div>

    <div *ngIf="processing" class="text-center mt-4">
      <div class="spinner-border"
           style="width: 4rem; height: 4rem;"
           role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
    </div>
  </div>

  <div class="modal-footer">
    <button type="button"
            class="btn btn-secondary"
            (click)="modal.dismiss('cancel')">
      Cerrar
    </button>

    <button *ngIf="!processing && !feedbackMessage"
            type="button"
            class="btn btn-primary"
            (click)="confirmResetPassword(modal)">
      Enviar
    </button>
  </div>
</ng-template>
